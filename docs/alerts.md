# さくらセキュリティガード アラート機能

作成日: 2025-04-15
作成者: 開発チーム

## 概要

アラート機能は、さくらセキュリティガードの重要なコンポーネントの一つで、セキュリティイベントが特定の条件を満たした場合に通知を生成し、ユーザーに迅速に情報を提供します。この機能により、セキュリティインシデントへの早期対応が可能になります。

## アーキテクチャ

アラート機能は以下のコンポーネントで構成されています：

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  アラートルール  │────▶│  アラート生成   │────▶│  通知チャネル   │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

1. **アラートルール**: セキュリティイベントがアラートを生成する条件を定義します
2. **アラート生成**: ルールに基づいてアラートを生成し、データベースに保存します
3. **通知チャネル**: 生成されたアラートを様々な方法（メール、Slack、Webhook等）でユーザーに通知します

## データモデル

### アラート

アラートは以下の情報を含みます：

- **ID**: アラートの一意識別子
- **ルールID**: アラートを生成したルールの参照
- **タイムスタンプ**: アラートが生成された日時
- **重要度**: アラートの重要度（critical, high, medium, low）
- **タイトル**: アラートの簡潔な説明
- **説明**: アラートの詳細な説明
- **ソースイベントID**: アラートの原因となったセキュリティイベントの参照
- **詳細情報**: アラートに関連する追加情報（送信元IP、対象サービス等）
- **ステータス**: アラートの現在の状態（pending, sent, acknowledged, resolved, open, investigating, mitigated）
- **通知状況**: 各通知チャネルの配信状況
- **確認情報**: アラートを確認したユーザーと日時
- **解決情報**: アラートを解決したユーザーと日時、解決メモ

### アラートルール

アラートルールは以下の情報を含みます：

- **ID**: ルールの一意識別子
- **名前**: ルールの名前
- **説明**: ルールの詳細な説明
- **条件**: アラートを生成する条件（脅威検出、ログパターン、メトリックしきい値、異常検出）
- **通知チャネル**: アラートを送信する通知チャネルのリスト
- **スロットリング**: 短時間に多数のアラートが生成されるのを防ぐための設定
- **有効/無効**: ルールの有効状態
- **作成日時/更新日時**: ルールの作成日時と最終更新日時
- **タグ**: ルールの分類や検索用のタグ

### 通知チャネル

通知チャネルは以下の情報を含みます：

- **ID**: チャネルの一意識別子
- **名前**: チャネルの名前
- **説明**: チャネルの詳細な説明
- **方法**: 通知方法（メール、Slack、Webhook、SMS、プッシュ通知）
- **設定**: 通知方法に応じた設定情報
- **有効/無効**: チャネルの有効状態
- **作成日時/更新日時**: チャネルの作成日時と最終更新日時
- **タグ**: チャネルの分類や検索用のタグ

## API

アラート機能は以下のAPIエンドポイントを提供します：

### アラート一覧の取得

```
GET /api/alerts
```

**クエリパラメータ**:
- `page`: ページ番号（デフォルト: 1）
- `per_page`: 1ページあたりの件数（デフォルト: 10）
- `severity`: 重要度によるフィルタリング（オプション）
- `status`: ステータスによるフィルタリング（オプション）

**レスポンス**:
```json
{
  "data": [
    {
      "id": "alert-1",
      "rule_id": "rule-1",
      "timestamp": "2025-04-15T10:00:00Z",
      "severity": "high",
      "title": "ブルートフォース攻撃検出",
      "description": "SSH接続への複数回の失敗したログイン試行が検出されました",
      "source_event_id": "event-1",
      "details": {
        "source_ip": "192.168.1.100",
        "target_service": "SSH",
        "failed_attempts": 10
      },
      "status": "open"
    },
    // ...
  ],
  "pagination": {
    "total": 100,
    "page": 1,
    "per_page": 10,
    "total_pages": 10
  }
}
```

### アラート詳細の取得

```
GET /api/alerts/:id
```

**パスパラメータ**:
- `id`: アラートID

**レスポンス**:
```json
{
  "id": "alert-1",
  "rule_id": "rule-1",
  "timestamp": "2025-04-15T10:00:00Z",
  "severity": "high",
  "title": "ブルートフォース攻撃検出",
  "description": "SSH接続への複数回の失敗したログイン試行が検出されました",
  "source_event_id": "event-1",
  "details": {
    "source_ip": "192.168.1.100",
    "target_service": "SSH",
    "failed_attempts": 10,
    "time_window": "5分",
    "detection_rule": "ブルートフォース検出ルール"
  },
  "status": "open",
  "notification_status": [
    {
      "channel_id": "email-1",
      "status": "delivered",
      "timestamp": "2025-04-15T10:01:00Z"
    },
    {
      "channel_id": "slack-1",
      "status": "delivered",
      "timestamp": "2025-04-15T10:01:00Z"
    }
  ]
}
```

### アラートステータスの更新

```
PUT /api/alerts/:id/status
```

**パスパラメータ**:
- `id`: アラートID

**リクエストボディ**:
```json
{
  "status": "investigating",
  "note": "調査を開始しました"
}
```

**レスポンス**:
```json
{
  "id": "alert-1",
  "status": "investigating",
  "updated_at": "2025-04-15T10:30:00Z",
  "updated_by": "user-1"
}
```

## フロントエンド

アラート機能は以下のフロントエンドページを提供します：

1. **アラート一覧ページ** (`/alerts`): 全てのアラートを一覧表示し、フィルタリングや並べ替えが可能
2. **アラート詳細ページ** (`/alert-detail/:id`): 特定のアラートの詳細情報を表示し、ステータス更新などのアクションが可能
3. **アラートルール設定ページ** (`/alert-rules`): アラートルールの作成、編集、削除が可能
4. **通知チャネル設定ページ** (`/notification-channels`): 通知チャネルの作成、編集、削除が可能

## 実装状況

現在の実装状況は以下の通りです：

- ✅ アラートデータモデルの定義
- ✅ アラート一覧APIの実装
- ✅ アラート詳細APIの実装
- ✅ アラート一覧ページの実装
- ✅ アラート詳細ページの実装
- 🔄 アラートステータス更新APIの実装（モックのみ）
- 🔄 アラートルール設定ページの実装（未着手）
- 🔄 通知チャネル設定ページの実装（未着手）

## 今後の課題

1. **リアルタイム通知**: WebSocketを使用したリアルタイムアラート通知の実装
2. **アラートの集約**: 類似したアラートを集約して通知の洪水を防ぐ機能
3. **カスタム通知テンプレート**: ユーザーが通知内容をカスタマイズできる機能
4. **アラート自動対応**: 特定のアラートに対して自動的に対応アクションを実行する機能
5. **アラート分析**: アラートの傾向分析やレポート機能

## 参考資料

- [OWASP Proactive Controls](https://owasp.org/www-project-proactive-controls/)
- [NIST SP 800-61: Computer Security Incident Handling Guide](https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final)
- [AWS Security Hub](https://aws.amazon.com/security-hub/)
- [Azure Security Center](https://azure.microsoft.com/services/security-center/)